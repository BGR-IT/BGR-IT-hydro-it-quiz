<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Badger Hydro IT Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
    }
    h1, h2 {
      color: #2c3e50;
    }
    .container {
      background-color: #ffffff;
      padding: 20px;
      margin-bottom: 40px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .question {
      margin-bottom: 20px;
    }
    .question h3 {
      margin-bottom: 10px;
    }
    .score {
      font-size: 1.2em;
      color: green;
      margin-top: 20px;
    }
    .timer {
      font-size: 1.1em;
      color: #d35400;
      margin-bottom: 20px;
    }
    input[type="submit"], button {
      padding: 10px 20px;
      font-size: 1em;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    input[type="text"], input[type="date"] {
      padding: 8px;
      font-size: 1em;
      width: 300px;
      margin-bottom: 20px;
    }
    iframe {
      width: 100%;
      border: none;
    }
    .leaderboard-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
    }
    .leaderboard-table th, .leaderboard-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    .leaderboard-table th {
      background-color: #3498db;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Badger Hydro IT Quiz</h1>

  <div class="container">
    <h2>Quiz</h2>
    <div class="timer" id="timerDisplay">Time: 00:00</div>
    <form id="quizForm">
      <label for="username"><strong>Your Name:</strong></label><br>
      <input type="text" id="username" name="username" required><br>
      <label for="date"><strong>Date:</strong></label><br>
      <input type="date" id="date" name="date" required><br><br>
      <div id="questions"></div>
      <input type="submit" value="Submit Score">
    </form>
    <div class="score" id="scoreDisplay"></div>
    <div class="container">
      <h2>Local Leaderboard (Top 3 Including Ties)</h2>
      <table class="leaderboard-table" id="localLeaderboard">
        <thead>
          <tr><th>Name</th><th>Score</th><th>Date</th><th>Time</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="container">
    <h2>Google Sheet Leaderboard</h2>
    <iframe src="https://docs.google.com/spreadsheets/d/15EQbAvl_iESL0UpWhMHvHwkqT2awIhI8KW0243-WD_A/pubhtml?gid=0&single=true&widget=true&headers=false" width="100%" height="400" frameborder="0"></iframe>
  </div>

  <script>
    const questions = [
      ["What is the largest planet in our solar system?", ["Earth", "Mars", "Jupiter", "Saturn"], "Jupiter"],
      ["Which of the following animals is known to have the longest lifespan?", ["Elephant", "Tortoise", "Whale", "Parrot"], "Tortoise"],
      ["What is the capital city of France?", ["Berlin", "Madrid", "Paris", "London"], "Paris"],
      ["Which movie features a giant shark named Jaws?", ["Titanic", "Jaws", "Finding Nemo", "Sharknado"], "Jaws"],
      ["Which fruit is known as the 'king of fruits' due to its strong smell?", ["Pineapple", "Durian", "Mango", "Banana"], "Durian"],
      ["What is the name of the famous wizarding school in the Harry Potter series?", ["Hogwarts", "Narnia Academy", "The Shire Institute", "Rivendell Academy"], "Hogwarts"],
      ["What color is a giraffe's tongue?", ["Blue", "Pink", "Purple", "Green"], "Purple"],
      ["Which country is the largest producer of coffee?", ["Colombia", "Brazil", "Ethiopia", "Vietnam"], "Brazil"],
      ["Which vegetable is known for making people cry when chopped?", ["Onion", "Garlic", "Carrot", "Tomato"], "Onion"],
      ["Which of the following is not a type of cloud?", ["Cumulus", "Stratus", "Cirrus", "Nimbus"], "Nimbus"],
      ["What is the primary purpose of a hydro-excavation truck?", ["To mix concrete", "To dig holes using high-pressure water", "To collect waste from construction sites", "To clear snow"], "To dig holes using high-pressure water"],
      ["Which of the following programming languages is commonly used in web development?", ["Python", "HTML", "Java", "Ruby"], "HTML"],
      ["What type of IT system would you use to monitor a hydro-excavation truckâ€™s GPS location in real-time?", ["Oracle ERP Cloud", "Samsara", "NetSuite", "Instagram"], "Samsara"],
      ["What is the name of the standard data protection regulation in the European Union?", ["HIPAA", "GDPR", "CCPA", "PCI-DSS"], "GDPR"],
      ["What is a 'sandbox' in the context of IT development?", ["A type of test environment", "A place to store unused data", "A backup storage solution", "A web server software"], "A type of test environment"],
      ["What is the main benefit of using hydro-excavation over traditional excavation methods?", ["It's faster", "It's safer for sensitive underground utilities", "It's cheaper", "It requires no permits"], "It's safer for sensitive underground utilities"],
      ["What does 'IT' stand for?", ["Information Technology", "Intelligent Tools", "International Trades", "Internet Telephony"], "Information Technology"],
      ["Which company is known for its popular cloud computing services like Azure?", ["Microsoft", "Apple", "Amazon", "Google"], "Microsoft"],
      ["What is the main function of a hydro-excavation vacuum system?", ["To collect debris from construction sites", "To carry water from the source to the excavation site", "To suck up the excavated material into a debris tank", "To clean construction equipment"], "To suck up the excavated material into a debris tank"],
      ["Which IT tool is commonly used for project management within the Badger IT team?", ["Photoshop", "Zoho", "Google Maps", "Dropbox"], "Zoho"]
    ];

    const questionsDiv = document.getElementById("questions");
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question q" + i;
      const h3 = document.createElement("h3");
      h3.textContent = (i + 1) + ". " + q[0];
      div.appendChild(h3);
      q[1].forEach(opt => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="radio" name="q${i}" value="${opt}" required> ${opt}`;
        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });
      const hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = "a" + i;
      hidden.value = q[2];
      div.appendChild(hidden);
      questionsDiv.appendChild(div);
    });

    let timerInterval;
    let secondsElapsed = 0;
    function startTimer() {
      secondsElapsed = 0;
      document.getElementById("timerDisplay").textContent = "Time: 00:00";
      timerInterval = setInterval(() => {
        secondsElapsed++;
        let min = Math.floor(secondsElapsed / 60);
        let sec = secondsElapsed % 60;
        document.getElementById("timerDisplay").textContent = `Time: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }, 1000);
    }
    function stopTimer() {
      clearInterval(timerInterval);
    }

    window.onload = function() {
      startTimer();
      renderLocalLeaderboard();
    };

    document.getElementById('quizForm').addEventListener('submit', function(e) {
      e.preventDefault();
      stopTimer();
      let score = 0;
      for (let i = 0; i < questions.length; i++) {
        const selected = document.querySelector('input[name="q' + i + '"]:checked');
        const correct = document.querySelector('input[name="a' + i + '"]').value;
        if (selected && selected.value === correct) {
          score++;
        }
      }
      const name = document.getElementById("username").value.trim();
      const date = document.getElementById("date").value;
      const min = Math.floor(secondsElapsed / 60);
      const sec = secondsElapsed % 60;
      const timeStr = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      document.getElementById('scoreDisplay').innerText = "Your score: " + score + " out of " + questions.length + " | Time: " + timeStr;
      updateLocalLeaderboard(name, score, date, timeStr);
      submitToGoogleForm(name, score, date);
    });

    function updateLocalLeaderboard(name, score, date, timeStr) {
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      leaderboard.push({ name, score, date, time: timeStr });
      leaderboard.sort((a, b) => {
        if (b.score !== a.score) return b.score - a.score;
        const [am, as] = a.time.split(':').map(Number);
        const [bm, bs] = b.time.split(':').map(Number);
        return (am * 60 + as) - (bm * 60 + bs);
      });
      let topScores = [];
      let rank = 0;
      let lastScore = null;
      for (let i = 0; i < leaderboard.length; i++) {
        if (rank < 3 || leaderboard[i].score === lastScore) {
          topScores.push(leaderboard[i]);
          if (leaderboard[i].score !== lastScore) rank++;
          lastScore = leaderboard[i].score;
        } else {
          break;
        }
      }
      localStorage.setItem("leaderboard", JSON.stringify(topScores));
      renderLocalLeaderboard();
    }

    function renderLocalLeaderboard() {
      const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      const tbody = document.querySelector("#localLeaderboard tbody");
      tbody.innerHTML = "";
      leaderboard.forEach(entry => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${entry.name}</td><td>${entry.score}</td><td>${entry.date}</td><td>${entry.time}</td>`;
        tbody.appendChild(row);
      });
    }

    function submitToGoogleForm(name, score, date) {
      const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdhtKfXSKnf14bU3dOVuika6sTGRftEFZuWEje6ZJ4FxKtdFA/formResponse";
      const data = new FormData();
      data.append("entry.238187609", name);
      data.append("entry.822603217", score);
      data.append("entry.2090656816", date);
      fetch(formUrl, { method: "POST", mode: "no-cors", body: data });
    }
  </script>
</body>
</html>
